# 6H-lab4实验报告
- 负责选课、筛选、退课等后端接口
- 编写自动化接口测试用例
- 实现后端华为云自动化编译、部署
- 前端学生选课界面（可选、已选、已修、课表）
- 前端部署
- 系统测试
-课程增加新信息：上课学期、课程类型、可选专业、教室容量
-学期、选课阶段管理
-管理员、开课教师、选课学生查看课程信息
-学生选课申请与管理员审核
-管理员条件搜索

##2、实验设计
### 后端整体结构
![img.png](imgs/img.png)

后端整体结构如上图所示，其中`entity`包中的类信息同时代表数据库表信息。

结构整体上较为清晰，`controller`中接口接受响应后，调用`service`包中相应的类，相应类通过`mapper`包中数据库的映射进行数据库信息的增删改查。

其中`data`包中为普通的接口类， `utils`包中为必要的工具类，`interceptor`包中为必要的拦截器类。

`interceptor`包中类是面向切面设计，这里不再用类图展示包关联。

由于相应的关联类名称前缀基本相同，并且具有明显的包关联结构，所以这里使用包关联展示大致信息。
### service类设计
![img_5.png](imgs/img_5.png)

如图所示，具体`service`操作通过相应的`server`类参与到`Spring`框架的`IOC`中。

同时`server`类通过在相应的方法中包含`checker`和`handler`的类信息，通过中实例化调用或调用静态方法，分别实现了接口数据合法性检查和数据增删改时数据库信息的依赖检测。

![img_6.png](imgs/img_6.png)
这一设计方式极大减少了检查工作造成的代码重复现象。具体结构如图例所示。

### mapper类设计
![img_2.png](imgs/img_2.png)
如图所示，`mapper`类通过继承`JPA`接口实现相应的数据库操作

### interceptor类设计
![img_3.png](imgs/img_3.png)

这里通过时序图来阐明`interceptor`类的设计，拦截器依托于session机制和小组url接口的设计协议来进行前端请求的权限验证。 能够有效确保登录验证和身份权限验证

![img_4.png](imgs/img_4.png)
相应类信息如图所示，前缀表明要求的身份信息或者登录状态。

## 2、问题及解决方案
#### 1，多重条件下的相同数据请求
处理人：王耕宇
在获取选课信息的情况中，由于前端根据课程Id、学生id、选课状态、老师id等不同的条件获取选课接口，条件比较杂乱。
解决方案： 对请求接口进行处理，允许在不使用相应的查询条件时其值为空。这是通过mysql语句判空来作为依托的，涉及了比较高的mysql知识。
#### 2，前端要求的返回数据不在同一表内
处理人：王耕宇
在有些情况下，前端要求获取选课信息及关联的教师名字，由于JPA的接受类限制，这一情况也是一个较难实现的问题。
解决方案：在使用mysql的子查询、多表查询功能基础上，使用字符串流接受数据后再映射到相关类中。
#### 3，如何实现自动化部署
处理人：王耕宇
在lab4阶段对自动化部署进行了实践，自动化部署极大地方便了部署操作，且能及时地将bug修复并重新部署
解决方法：使用华为云的流水线进行部署，先编译打包，再推送到服务器启动SpringBoot。设置流水线触发条件为代码提交或者打标签时，美滋滋。
## 3、代码检查结果
#### 前端
![img_8.png](imgs/img_8.png)
#### 后端
![img_7.png](imgs/img_7.png)

## 4、软件测试
### 单元测试
使用JUnit进行单元测试，测试截图如下：
![img_10.png](imgs/img_10.png)
### 接口自动化测试
#### 开课
![img_11.png](imgs/img_11.png)
#### 选课申请、扩容、退课
![img_13.png](imgs/img_13.png)
### 系统测试
每个测试计划执行历史如下，至最新一次历史执行所有测试步骤完成通过。
![](https://cdn.nlark.com/yuque/0/2022/png/22909236/1653065505660-1a5b7a27-4f1b-4b67-91bb-b0fa772941dd.png)
![](https://cdn.nlark.com/yuque/0/2022/png/22909236/1653065736050-a2e04d27-e7bb-40e2-a7b7-b96b22c0455b.png)
![](https://cdn.nlark.com/yuque/0/2022/png/22909236/1653065779680-b4b73c45-02d0-42ad-9b8d-bdbdec7245ae.png)
![](https://cdn.nlark.com/yuque/0/2022/png/22909236/1653065846848-b810f2aa-a378-4011-95cf-436c7de627ad.png)
![](https://cdn.nlark.com/yuque/0/2022/png/22909236/1653065865850-18a15c8f-dfe7-4c18-ac89-f72ced23e4cb.png)
![](https://cdn.nlark.com/yuque/0/2022/png/22909236/1653065891213-686cb342-7be0-4b34-94f2-e9ea75c03695.png)
![](https://cdn.nlark.com/yuque/0/2022/png/22909236/1653065907863-a15c42a4-d315-423c-a759-584229b5325f.png)
![](https://cdn.nlark.com/yuque/0/2022/png/22909236/1653065920737-29a141d7-cffe-436e-a4d2-dd8055146f01.png)
![](https://cdn.nlark.com/yuque/0/2022/png/22909236/1653065938749-d9f90763-d4d8-45fc-93b7-d6d7fffc1371.png)
![](https://cdn.nlark.com/yuque/0/2022/png/22909236/1653065989435-07e77b04-80ae-41cf-aaca-bb043c5fa7b3.png)
![](https://cdn.nlark.com/yuque/0/2022/png/22909236/1653066002735-e2ba4726-5afd-42f1-8240-d08c8a009ece.png)
![](https://cdn.nlark.com/yuque/0/2022/png/22909236/1653066016291-f0d8e99e-795d-449f-b16f-88bdd932af33.png)
![](https://cdn.nlark.com/yuque/0/2022/png/22909236/1653066031284-bd818838-fd4c-4e81-89ee-4b2e2b2c63a3.png)
![](https://cdn.nlark.com/yuque/0/2022/png/22909236/1653066040182-60231e50-4876-44a3-bc77-471652e2d490.png)
![](https://cdn.nlark.com/yuque/0/2022/png/22909236/1653066079862-003dced7-f4df-44b8-9c01-807afdff64cb.png)
![](https://cdn.nlark.com/yuque/0/2022/png/22909236/1653066093089-878aaf75-2819-4850-8f24-539533ca6d7f.png)
![](https://cdn.nlark.com/yuque/0/2022/png/22909236/1653066106763-e8cd290e-7b13-48a8-b2e9-4144e649b8f0.png)

## 5、缺陷管理
![img.png](imgs/img22.png)

## 6、Tag截图
![img.png](imgs/img23.png)
![img.png](imgs/img24.png)
## 7、心得体会
总体感觉还好，在筛选的过程中涉及到了一些高阶mysql知识，在设计后端项目自动化部署的过程中遇到了一些困难，在写接口自动化测试用例的时候也是慢慢摸索得出了写的经验，包括JUnit也是要慢慢摸索的过程中进行了了解，总体感觉这次压力比较小。
主要问题还是出在前后端协同和进度上，大家制定的进度往往无法按时完成，最后还是演化成了赶ddl。在结构设计和任务分配上出现了一些前后端的责任空缺，感觉这样很不好，大家应该尽量弥补重叠，而不是暴露空缺没人管。
另外就是测试问题，有些测试在一开始是好的，但是在后边人的修改过程中又成了错误的，这给测试造成了很大的麻烦。
